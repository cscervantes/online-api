extends ../layout
block css
    style.
        fieldset 
        {
            border: 1px solid #ddd !important;
            margin: 0;
            xmin-width: 0;
            padding: 10px;       
            position: relative;
            border-radius:4px;
            background-color:#f5f5f5;
            padding-left:10px!important;
        }
        legend
        {
            font-size:14px;
            font-weight:bold;
            margin-bottom: 0px; 
            width: 35%; 
            border: 1px solid #ddd;
            border-radius: 4px; 
            padding: 5px 5px 5px 10px; 
            background-color: #ffffff;
        }
        
block content

    h1= title
    div.row
        fieldset.form-group.col-md

            legend Basic Information (IMPORTANT)

            div.form-group
                label(for="website_name") Website Name 
                input#website_name(type="text", name="website_name", required="required", class="form-control")
            
            div.form-group
                label(for="website_url") Website Url
                input#website_url(type="text", name="website_url", required="required", class="form-control")

            div.form-group
                label(for="fqdn") FQDN
                input#fqdn(type="text", name="fqdn", disabled="disabled", class="form-control")
            
            div.form-group
                label(for="category") Category
                select#category(name="category", class="form-control")
                    option(value="News") News
                    option(value="Blog") Blog
            
            div.form-group
                label(for="region") Region
                input#region(type="text", name="region", required="required", class="form-control")

            div.form-group
                label(for="country") Country
                input#country(type="text", name="country", required="required", class="form-control")

            div.form-group
                label(for="needs_endslash") Needs End Slash
                select#needs_endslash(name="needs_endslash", class="form-control")
                    option(value="false") False
                    option(value="true") True

            div.form-group
                label(for="has_subsection") Has Subsection
                select#has_subsection(name="has_subsection", class="form-control")
                    option(value="false") False
                    option(value="true") True
            
            div.form-group
                label(for="main_sections") Main Sections
                textarea#main_sections.form-control(name="main_sections", cols="30", rows="5")

            div.form-group
                label(for="sub_sections") Sub Sections
                textarea#sub_sections.form-control(name="sub_sections", cols="30", rows="5")

        fieldset.form-group.col-md

            legend Main Section Information (VERY IMPORTANT)

            div.form-group
                label(for="section_config") Main Section Config
                .form-group
                    label(for="section_config_starts") Skip url starts with
                    textarea#section_config_starts.form-control(name="section_config_starts", cols="30", rows="5")
                .form-group
                    label(for="section_config_ends") Skip url ends with
                    textarea#section_config_ends.form-control(name="section_config_ends", cols="30", rows="5")
                .form-group
                    label(for="section_config_contains") Skip url contains with
                    textarea#section_config_contains.form-control(name="section_config_contains", cols="30", rows="5")
                .form-group
                    label(for="section_config_exact") Skip exact url
                    textarea#section_config_exact.form-control(name="section_config_exact", cols="30", rows="5")
                .form-group
                    label(for="section_config_accept") Accept Only
                    textarea#section_config_accept.form-control(name="section_config_accept", cols="30", rows="5")
                .form-group
                    label(for="section_regex_include") Regex Include Only
                    textarea#section_regex_include.form-control(name="section_regex_include", cols="30", rows="5")
                .form-group
                    label(for="section_regex_exclude") Regex Exclude Only
                    textarea#section_regex_exclude.form-control(name="section_regex_exclude", cols="30", rows="5")
            
        fieldset.form-group.col-md
            
            legend Sub Section Information (VERY IMPORTANT)

            div.form-group
                label(for="section_config") Sub Section Config
                .form-group
                    label(for="section_config_starts2") Skip url starts with
                    textarea#section_config_starts2.form-control(name="section_config_starts2", cols="30", rows="5")
                .form-group
                    label(for="section_config_ends2") Skip url ends with
                    textarea#section_config_ends2.form-control(name="section_config_ends2", cols="30", rows="5")
                .form-group
                    label(for="section_config_contains2") Skip url contains with
                    textarea#section_config_contains2.form-control(name="section_config_contains2", cols="30", rows="5")
                .form-group
                    label(for="section_config_exact2") Skip exact url
                    textarea#section_config_exact2.form-control(name="section_config_exact2", cols="30", rows="5")
                .form-group
                    label(for="section_config_accept2") Accept Only
                    textarea#section_config_accept2.form-control(name="section_config_accept2", cols="30", rows="5")
                .form-group
                    label(for="section_regex_include2") Regex Include Only
                    textarea#section_regex_include2.form-control(name="section_regex_include2", cols="30", rows="5")
                .form-group
                    label(for="section_regex_exclude2") Regex Exclude Only
                    textarea#section_regex_exclude2.form-control(name="section_regex_exclude2", cols="30", rows="5")

    button#add(type="button" class="btn btn-outline-primary btn-rounded waves-effect", style="position:fixed; bottom:10px; right:10px") Add
    
block js
    script(src="/resources/string/dist/string.min.js")
    script.
        function checkForempty(a) {
            var r;
            if(Array.isArray(a)) {
                if(a.length === 1 && a[0] === "") {
                    r =  new Array(0);
                } else {
                    r = a;
                }   
            }
            return r;
        }  

        $('#add').click(function(){
            var jsonData = {}
            var website_name = $('#website_name').val()
            var website_url = $('#website_url').val()
            var fqdn = $('#fqdn').val()
            var category = $('#category').val()
            var region = $('#region').val() || null
            var country = $('#country').val() || null
            var needs_endslash = $('#needs_endslash').val()
            var has_subsection = $('#has_subsection').val()
            var main_section_config = {
                'startsWith' : checkForempty(S($('#section_config_starts').val()).split(',')).map(function(v){
                return S(v).trim().s
            }),
                'endsWith' : checkForempty(S($('#section_config_ends').val()).split(',')).map(function(v){
                return S(v).trim().s
            }),
                'containsWith' : checkForempty(S($('#section_config_contains').val()).split(',')).map(function(v){
                return S(v).trim().s
            }),
                'exact' : checkForempty(S($('#section_config_exact').val()).split(',')).map(function(v){
                    return S(v).trim().s
                }),
                'accept_only' : checkForempty(S($('#section_config_accept').val()).split(',')).map(function(v){
                    return S(v).trim().s
                }),
                'regex_include' : checkForempty(S($('#section_regex_include').val()).splitLeft(',')).map(function(v){
                    return S(v).trim().s
                }),
                'regex_exclude' : checkForempty(S($('#section_regex_exclude').val()).splitLeft(',')).map(function(v){
                    return S(v).trim().s
                })
            }
            var sub_section_config = {
                'startsWith' : checkForempty(S($('#section_config_starts2').val()).split(',')).map(function(v){
                return S(v).trim().s
            }),
                'endsWith' : checkForempty(S($('#section_config_ends2').val()).split(',')).map(function(v){
                return S(v).trim().s
            }),
                'containsWith' : checkForempty(S($('#section_config_contains2').val()).split(',')).map(function(v){
                return S(v).trim().s
            }),
                'exact' : checkForempty(S($('#section_config_exact2').val()).split(',')).map(function(v){
                    return S(v).trim().s
                }),
                'accept_only' : checkForempty(S($('#section_config_accept2').val()).split(',')).map(function(v){
                    return S(v).trim().s
                }),
                'regex_include' : checkForempty(S($('#section_regex_include2').val()).splitLeft(',')).map(function(v){
                    return S(v).trim().s
                }),
                'regex_exclude' : checkForempty(S($('#section_regex_exclude2').val()).splitLeft(',')).map(function(v){
                    return S(v).trim().s
                })
            }
            var main_sections = checkForempty(S($('#main_sections').val()).split(',')).map(function(v){
                return S(v).trim().s
            })
            var sub_sections = checkForempty(S($('#sub_sections').val()).split(',')).map(function(v){
                return S(v).trim().s
            })


            if(website_name.trim() && website_url.trim()){
                jsonData.website_name = website_name
                jsonData.website_url = website_url
                jsonData.fqdn = fqdn
                jsonData.category = category
                jsonData.region = region
                jsonData.country = country
                jsonData.needs_endslash = needs_endslash
                jsonData.has_subsection = has_subsection
                jsonData.main_section_config = main_section_config
                jsonData.sub_section_config = sub_section_config
                jsonData.main_sections = main_sections
                jsonData.sub_sections = sub_sections
                //- console.log(jsonData)
                $.ajax({
                    dataType : "json",
                    contentType: "application/json; charset=utf-8",
                    url: '/websites/store',
                    method: 'POST',
                    data: JSON.stringify(jsonData)
                }).done(function(response){
                    console.log(response)
                }).fail(function(response){
                    console.log(response)
                })
            }else{
                alert('Website Name and Website Url are required')
            }
        })
        
        $(document).on('keyup', '#website_name', function(){
            $(this).css({
                'text-transform': 'capitalize'
            })
        })

        $(document).on('keyup', '#region', function(){
            $(this).css({
                'text-transform': 'capitalize'
            })
        })

        $(document).on('keyup', '#country', function(){
            $(this).css({
                'text-transform': 'capitalize'
            })
        })

        $(document).on('change', '#website_url', function(){
            $(this).css({
                'text-transform': 'lowercase'
            })
            var t = $(this).val()
            if(S(t).startsWith('http://') || S(t).startsWith('https://')){
                var fqdn = S(t).splitLeft('/')[2]
                $('#fqdn').val(fqdn)
                $(this).val(S(t).splitRight('/', 1, -1)[0])
            }else{
                alert('Not a valid Website Url')
                $(this).focus()
            }
        })
